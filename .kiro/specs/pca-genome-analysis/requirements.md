# 需求文档

## 简介

本项目实现主成分分析(PCA)对基因组数据进行降维和可视化分析。数据来自国际基因组样本资源(International Genome Sample Resource)，包含995个个体的基因组数据。目标是通过PCA分析揭示基因组数据中的模式，并解释主成分的生物学意义。

## 术语表

- **PCA (Principal Component Analysis)**: 主成分分析，一种降维技术
- **主成分 (Principal Component)**: 数据方差最大的方向
- **投影 (Projection)**: 将高维数据映射到低维空间
- **众数核苷酸 (Mode Nucleobase)**: 某位置上出现最频繁的核苷酸
- **核苷酸 (Nucleobase)**: DNA的基本单位，包括A、T、G、C四种
- **基因型 (Genotype)**: 个体的遗传组成
- **表型 (Phenotype)**: 个体的可观察特征

## 需求

### 需求 1: 数据加载和预处理

**用户故事:** 作为数据分析师，我想加载并预处理基因组数据，以便进行PCA分析。

#### 验收标准

1. WHEN 程序启动 THEN 系统应从`p4dataset2024.txt`加载995个个体的数据
2. WHEN 加载数据 THEN 系统应正确解析每行的个体ID、性别、种群标签和10101个核苷酸
3. WHEN 读取元数据 THEN 系统应从`p4dataset2024_decoding.txt`加载种群标签的解码信息
4. WHEN 提取基因数据 THEN 系统应忽略前3列元数据，只使用后10101列核苷酸数据
5. WHEN 处理核苷酸 THEN 系统应识别A、T、G、C四种核苷酸类型

### 需求 2: 二值矩阵转换

**用户故事:** 作为研究人员，我想将核苷酸序列转换为二值矩阵，以便进行数值分析。

#### 验收标准

1. WHEN 转换数据 THEN 系统应计算每列（每个位置）的众数核苷酸
2. WHEN 创建二值矩阵X THEN 系统应设置X[i,j]=0如果第i个个体在第j个位置有众数核苷酸
3. WHEN 创建二值矩阵X THEN 系统应设置X[i,j]=1如果第i个个体在第j个位置有非众数核苷酸（突变）
4. WHEN 转换完成 THEN 系统应生成995×10101的二值矩阵
5. WHEN 验证转换 THEN 系统应确保所有值都是0或1

### 需求 3: PCA分析实现

**用户故事:** 作为机器学习工程师，我想对二值矩阵执行PCA，以便提取主成分。

#### 验收标准

1. WHEN 执行PCA THEN 系统应对数据进行中心化（减去样本均值）
2. WHEN 执行PCA THEN 系统不应对数据进行标准化（保留不同维度的方差差异）
3. WHEN 计算主成分 THEN 系统应返回单位长度的主成分向量
4. WHEN 使用库实现 THEN 系统应使用sklearn.decomposition.PCA或类似库
5. WHEN 提取主成分 THEN 系统应至少计算前3个主成分
6. WHEN 计算完成 THEN 系统应返回主成分向量和解释方差比例

### 需求 4: 问题(a) - 主成分维度

**用户故事:** 作为学生，我想确定PCA返回向量的维度，以便理解输出格式。

#### 验收标准

1. WHEN 回答问题(a) THEN 系统应计算并输出主成分向量的维度
2. WHEN 输出答案 THEN 系统应解释维度等于输入矩阵的列数（10101）

### 需求 5: 问题(b) - 前两个主成分的散点图

**用户故事:** 作为研究人员，我想可视化前两个主成分，以便观察种群分布模式。

#### 验收标准

1. WHEN 创建散点图 THEN 系统应将995个个体投影到前两个主成分上
2. WHEN 绘制散点图 THEN 系统应使用第一主成分作为x轴，第二主成分作为y轴
3. WHEN 着色数据点 THEN 系统应为每个种群使用不同的颜色
4. WHEN 显示图例 THEN 系统应包含种群标签的图例
5. WHEN 保存图表 THEN 系统应将图表保存为高分辨率图像文件

### 需求 6: 问题(c) - 解释前两个主成分

**用户故事:** 作为生物学家，我想理解前两个主成分的含义，以便解释数据模式。

#### 验收标准

1. WHEN 分析图表 THEN 系统应生成1-2句话描述图表中的基本事实
2. WHEN 解释主成分 THEN 系统应说明前两个主成分捕捉了什么数据特征
3. WHEN 提供解释 THEN 系统应考虑历史和地理因素

### 需求 7: 问题(d) - 第一和第三主成分的散点图

**用户故事:** 作为数据科学家，我想可视化第一和第三主成分，以便发现新的聚类模式。

#### 验收标准

1. WHEN 创建散点图 THEN 系统应将个体投影到第一和第三主成分张成的子空间
2. WHEN 绘制散点图 THEN 系统应使用第一主成分作为x轴，第三主成分作为y轴
3. WHEN 尝试标签方案 THEN 系统应测试不同的元数据标签（性别、种群等）
4. WHEN 选择最佳标签 THEN 系统应使用能最好解释聚类的标签方案
5. WHEN 显示图例 THEN 系统应包含所选标签的图例
6. WHEN 保存图表 THEN 系统应将图表保存为高分辨率图像文件

### 需求 8: 问题(e) - 解释第三主成分

**用户故事:** 作为研究人员，我想理解第三主成分捕捉的信息，以便解释观察到的模式。

#### 验收标准

1. WHEN 分析图表 THEN 系统应识别第三主成分中的显著模式
2. WHEN 输出答案 THEN 系统应用一句话说明第三主成分捕捉的信息

### 需求 9: 问题(f) - 第三主成分的值分布

**用户故事:** 作为生物信息学家，我想检查第三主成分的值分布，以便理解其生物学意义。

#### 验收标准

1. WHEN 创建图表 THEN 系统应绘制核苷酸索引（1-10101）vs第三主成分绝对值
2. WHEN 绘制图表 THEN 系统应使用x轴表示核苷酸索引，y轴表示绝对值
3. WHEN 观察模式 THEN 系统应识别图表中的显著特征
4. WHEN 提供解释 THEN 系统应给出可能的生物学解释（提示：染色体）
5. WHEN 保存图表 THEN 系统应将图表保存为高分辨率图像文件

### 需求 10: 问题(g) - 方差解释比例

**用户故事:** 作为统计学家，我想计算主成分解释的方差比例，以便评估降维效果。

#### 验收标准

1. WHEN 计算方差解释 THEN 系统应计算第一主成分解释的方差百分比
2. WHEN 计算方差解释 THEN 系统应计算前3个主成分解释的总方差百分比
3. WHEN 计算平方长度减少 THEN 系统应计算投影后平均平方长度的减少百分比
4. WHEN 输出结果 THEN 系统应清晰显示两个百分比值
5. WHEN 讨论结果 THEN 系统应生成1-2句话讨论结果是否令人惊讶

### 需求 11: 代码文档和输出

**用户故事:** 作为提交作业的学生，我想要完整的代码和清晰的输出，以便满足提交要求。

#### 验收标准

1. WHEN 编写代码 THEN 系统应包含所有问题的完整实现
2. WHEN 生成输出 THEN 系统应保存所有要求的图表
3. WHEN 输出答案 THEN 系统应清晰打印所有问题的答案
4. WHEN 组织代码 THEN 系统应将代码放在附录中或单独文件中
5. WHEN 添加注释 THEN 系统应包含清晰的代码注释
