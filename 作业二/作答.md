# 作业2：评估指标 - 答案

## 练习1：基于排序的评估指标，MAP@K, MRR@K

### 题目分析
- 查询#1排序：d1, d2, d3, d4, d5, d6, d7, d8, d9, d10
  相关文档：d1, d3, d4, d6, d7, d10 (6个相关文档)
- 查询#2排序：d3, d8, d7, d1, d2, d4, d5, d9, d10, d6
  相关文档：d8, d9 (2个相关文档)
- 查询#3排序：d7, d6, d5, d3, d2, d1, d9, d10, d4, d8
  相关文档：d5, d9, d8 (3个相关文档)

### (a) 计算每个查询的AP@5和AP@10，RR@5和RR@10

**查询#1：**
- AP@5计算：
  - 位置1：d1相关，P@1 = 1/1 = 1.0
  - 位置3：d3相关，P@3 = 2/3 = 0.667
  - 位置4：d4相关，P@4 = 3/4 = 0.75
  - AP@5 = (1.0 + 0.667 + 0.75) / 6 = 0.403

- AP@10计算：
  - 位置1：d1相关，P@1 = 1/1 = 1.0
  - 位置3：d3相关，P@3 = 2/3 = 0.667
  - 位置4：d4相关，P@4 = 3/4 = 0.75
  - 位置6：d6相关，P@6 = 4/6 = 0.667
  - 位置7：d7相关，P@7 = 5/7 = 0.714
  - 位置10：d10相关，P@10 = 6/10 = 0.6
  - AP@10 = (1.0 + 0.667 + 0.75 + 0.667 + 0.714 + 0.6) / 6 = 0.733

- RR@5计算：第一个相关文档在位置1，RR@5 = 1/1 = 1.0
- RR@10计算：第一个相关文档在位置1，RR@10 = 1/1 = 1.0

**查询#2：**
- AP@5计算：
  - 位置2：d8相关，P@2 = 1/2 = 0.5
  - AP@5 = 0.5 / 2 = 0.25

- AP@10计算：
  - 位置2：d8相关，P@2 = 1/2 = 0.5
  - 位置8：d9相关，P@8 = 2/8 = 0.25
  - AP@10 = (0.5 + 0.25) / 2 = 0.375

- RR@5计算：第一个相关文档在位置2，RR@5 = 1/2 = 0.5
- RR@10计算：第一个相关文档在位置2，RR@10 = 1/2 = 0.5

**查询#3：**
- AP@5计算：
  - 位置3：d5相关，P@3 = 1/3 = 0.333
  - AP@5 = 0.333 / 3 = 0.111

- AP@10计算：
  - 位置3：d5相关，P@3 = 1/3 = 0.333
  - 位置7：d9相关，P@7 = 2/7 = 0.286
  - 位置10：d8相关，P@10 = 3/10 = 0.3
  - AP@10 = (0.333 + 0.286 + 0.3) / 3 = 0.306

- RR@5计算：第一个相关文档在位置3，RR@5 = 1/3 = 0.333
- RR@10计算：第一个相关文档在位置3，RR@10 = 1/3 = 0.333

### (b) 计算系统的MAP@5、MAP@10、MRR@5和MRR@10

- MAP@5 = (0.403 + 0.25 + 0.111) / 3 = 0.255
- MAP@10 = (0.733 + 0.375 + 0.306) / 3 = 0.471
- MRR@5 = (1.0 + 0.5 + 0.333) / 3 = 0.611
- MRR@10 = (1.0 + 0.5 + 0.333) / 3 = 0.611

## 练习2：基于排序的评估指标，Precision@K, Recall@K, NDCG@K

### 题目分析
根据表1，查询有7个相关文档（相关性等级≥1），总共有2个完美文档(等级4)、1个优秀文档(等级3)、1个良好文档(等级2)、3个一般文档(等级1)。

### (a) 计算P@5和P@10
- P@5 = 相关文档数@前5位 / 5 = 4/5 = 0.8
- P@10 = 相关文档数@前10位 / 10 = 7/10 = 0.7

### (b) 计算R@5和R@10
- R@5 = 相关文档数@前5位 / 总相关文档数 = 4/7 = 0.571
- R@10 = 相关文档数@前10位 / 总相关文档数 = 7/7 = 1.0

### (c) 最大化P@5的排序示例
将4个相关文档放在前5位：832, 103, 256, 771, 909, 511, 302, 120, 441, 690
P@5 = 4/5 = 0.8

### (d) 最大化P@10的排序示例
将7个相关文档放在前7位：832, 103, 256, 771, 511, 120, 690, 909, 302, 441
P@10 = 7/10 = 0.7

### (e) 最大化R@5的排序示例
将5个相关文档放在前5位：832, 103, 256, 771, 511, 909, 302, 120, 441, 690
R@5 = 5/7 = 0.714

### (f) 最大化R@10的排序示例
将7个相关文档放在前7位：832, 103, 256, 771, 511, 120, 690, 909, 302, 441
R@10 = 7/7 = 1.0

### (g) R-Precision相关答案
当用户希望检查每个相关文档时，最合适的K值是总相关文档数R。这被称为R-Precision，即P@R。在这种情况下，K=7，因为查询有7个相关文档。

### (h) 计算平均精度（AP）
AP = (1/1 + 2/3 + 3/4 + 4/4 + 5/6 + 6/7 + 7/10) / 7 = (1 + 0.667 + 0.75 + 1 + 0.833 + 0.857 + 0.7) / 7 = 0.829

AP和MAP的区别：AP是单个查询的平均精度，MAP是所有查询AP的平均值。

### (i) 最大化AP的排序示例
将相关文档按相关性等级降序排列：832, 103, 256, 771, 511, 120, 690, 909, 302, 441
AP = (1/1 + 2/2 + 3/3 + 4/4 + 5/5 + 6/6 + 7/7) / 7 = 1.0

### (j) 计算DCG₅
DCG₅ = 4/log₂(2) + 3/log₂(3) + 2/log₂(4) + 1/log₂(5) + 0/log₂(6)
= 4/1 + 3/1.585 + 2/2 + 1/2.322 + 0
= 4 + 1.893 + 1 + 0.431 + 0 = 7.324

### (k) 计算NDCG₅

**(i) 理想前5排名：**
按相关性等级降序：832(4), 103(3), 256(2), 771(1), 511(1)

**(ii) 计算IDCG₅：**
IDCG₅ = 4/log₂(2) + 3/log₂(3) + 2/log₂(4) + 1/log₂(5) + 1/log₂(6)
= 4/1 + 3/1.585 + 2/2 + 1/2.322 + 1/2.585
= 4 + 1.893 + 1 + 0.431 + 0.387 = 7.711

**(iii) 计算NDCG₅：**
NDCG₅ = DCG₅ / IDCG₅ = 7.324 / 7.711 = 0.950

### (l) 其他评估指标
其他可用于评估排序性能的指标包括：
- F1-Score@K = 2 × (P@K × R@K) / (P@K + R@K)
- Hit Rate@K：是否在前K位找到至少一个相关文档
- Mean Reciprocal Rank (MRR)：第一个相关文档位置的倒数
- Normalized Discounted Cumulative Gain (NDCG@K)
- Expected Reciprocal Rank (ERR)

## 练习3：精确率-召回率曲线

### PR曲线绘制
基于练习2的数据，计算不同召回率下的精确率：

| 召回率 | 精确率 |
|--------|--------|
| 0.143  | 1.0    |
| 0.286  | 1.0    |
| 0.429  | 1.0    |
| 0.571  | 0.8    |
| 0.714  | 0.714  |
| 0.857  | 0.75   |
| 1.0    | 0.7    |

PR曲线应该从(0,1)开始，随着召回率增加，精确率逐渐下降，最终到达(1,0.7)。

## 练习4：其他评估指标

### 数据挖掘中的其他评估指标

**1. 分类任务：**
- **ROC-AUC**：受试者工作特征曲线下面积
- **F1-Score**：精确率和召回率的调和平均
- **Cohen's Kappa**：考虑偶然一致性的分类一致性
- **Matthews Correlation Coefficient (MCC)**：平衡的相关系数

**2. 回归任务：**
- **Mean Absolute Error (MAE)**：平均绝对误差
- **Root Mean Square Error (RMSE)**：均方根误差
- **Mean Absolute Percentage Error (MAPE)**：平均绝对百分比误差
- **R² Score**：决定系数

**3. 聚类任务：**
- **Silhouette Score**：轮廓系数
- **Davies-Bouldin Index**：聚类内紧密度和聚类间分离度
- **Calinski-Harabasz Index**：方差比准则

**4. 推荐系统：**
- **Hit Rate**：命中率
- **Coverage**：覆盖率
- **Diversity**：多样性指标
- **Novelty**：新颖性指标

**5. 异常检测：**
- **Precision-Recall for Anomalies**：异常检测的精确率-召回率
- **F1-Score for Anomalies**：异常检测的F1分数

这些指标的计算方法各不相同，需要根据具体任务和数据特点选择合适的评估指标。
