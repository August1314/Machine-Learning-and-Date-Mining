# Homework 4: 支持向量机(SVM)分类器

**课程**: 机器学习与数据挖掘 (Fall 2025)  
**姓名**: 梁力航
**学号**: 23336128

---

## 项目概述

本项目从零实现支持向量机(SVM)分类器，使用随机梯度下降(SGD)算法训练模型，对Adult Income数据集进行二分类任务，预测个人年收入是否超过$50K。

**重要**: 本实现**不使用**sklearn等预构建的SVM库，完全手动实现算法。

---

## 文件说明

```
Homework 4new/
├── svm_classifier.py              # 主程序（包含所有实现）
├── train.txt                      # 训练数据（43,957样本）
├── test.txt                       # 测试数据（4,885样本，无标签）
├── test_ground_truth.txt          # 测试数据真实标签
├── results_summary.txt            # 结果摘要文件
├── regularization_analysis.png    # 正则化分析图表
├── 实验报告.md                     # 完整实验报告
├── README.md                      # 本文件
└── SVM.pdf                        # 作业要求文档
```

---

## 环境要求

### Python版本
- Python 3.x

### 依赖库

```bash
pip install numpy matplotlib
```

或使用conda：

```bash
conda install numpy matplotlib
```

---

## 快速开始

### 1. 运行程序

```bash
cd "Homework 4new"
python svm_classifier.py
```

### 2. 程序执行流程

程序将自动完成以下步骤：

1. **数据加载和预处理** (约10秒)
   - 加载训练数据（43,957样本）
   - 加载测试数据和真实标签（4,885样本）
   - 特征编码（分类特征 → 数值）
   - 特征标准化（Z-score）
   - 标签转换（"<=50K" → -1, ">50K" → +1）

2. **正则化分析** (约2分钟)
   - 测试4个不同的λ值：[0.001, 0.01, 0.1, 1.0]
   - 每个λ值训练一个独立的SVM模型（50 epochs）
   - 在真实测试集上评估准确率

3. **结果输出**
   - 打印所有λ值的测试准确率
   - 生成结果摘要文件 (`results_summary.txt`)
   - 生成可视化图表 (`regularization_analysis.png`)

4. **最终模型训练**
   - 使用最佳λ值训练最终模型
   - 在测试集上进行预测和评估
   - 显示最终测试准确率

### 3. 预期输出

程序运行完成后，你将看到：

```
============================================================
SVM分类器 - Adult Income数据集分类
============================================================

正在加载数据...
训练集样本数: 43957
测试集样本数: 4885

步骤1: 数据预处理
------------------------------------------------------------
训练集形状: (43957, 14)
标签分布: 10524 个 >50K, 33433 个 <=50K

步骤2: 正则化分析
------------------------------------------------------------
训练 SVM (λ = 0.001)...
测试准确率: 81.29%

训练 SVM (λ = 0.01)...
测试准确率: 81.56%

训练 SVM (λ = 0.1)...
测试准确率: 78.85%

训练 SVM (λ = 1)...
测试准确率: 76.60%

步骤3: 结果总结
------------------------------------------------------------
λ = 0.001: 测试准确率 = 81.29%
λ = 0.010: 测试准确率 = 81.56%
λ = 0.100: 测试准确率 = 78.85%
λ = 1.000: 测试准确率 = 76.60%

在本次实验中，λ = 0.01 获得了最高的测试准确率 81.56%

步骤4: 保存结果
------------------------------------------------------------
结果已保存到: results_summary.txt
图表已保存到: regularization_analysis.png

步骤5: 训练最终模型
------------------------------------------------------------
使用最佳λ值 0.01 在完整训练集上训练最终模型...
最终测试准确率: 81.27%

程序执行完成!
```

---

## 实验结果

### 正则化分析

| λ值   | 测试准确率 | 说明 |
|-------|-----------|------|
| 0.001 | 81.29%    | 正则化较弱 |
| 0.010 | **81.56%** | ⭐ 最优值 |
| 0.100 | 78.85%    | 正则化适中 |
| 1.000 | 76.60%    | 正则化较强，欠拟合 |

**最佳λ值**: 0.01  
**最高准确率**: 81.56%

### 可视化图表

程序会自动生成 `regularization_analysis.png`，展示：
- λ值（对数刻度）vs 测试准确率
- 每个点标注准确率数值
- 清晰的趋势线

---

## 算法说明

### SVM核心思想

支持向量机通过找到最优超平面来分离两类数据，使得间隔(margin)最大化。

**决策函数**:
```
f(x) = sign(w^T x + b)
```

**损失函数**: Hinge Loss + L2正则化
```
J(w, b) = (λ/2)||w||² + (1/n)Σ max(0, 1 - y_i(w^T x_i + b))
```

### 梯度公式（按作业要求）

对于每个样本 (x_k, y_k)：

**权重梯度**:
```
∇_w = λw                    如果 y_k(w^T x_k + b) ≥ 1
∇_w = λw - y_k x_k          否则
```

**偏置梯度**:
```
∇_b = 0                     如果 y_k(w^T x_k + b) ≥ 1
∇_b = -y_k                  否则
```

### SGD更新规则

```
w := w - η * ∇_w
b := b - η * ∇_b
```

其中 η 是学习率（本实验使用0.001）

---

## 数据集说明

### Adult Income数据集

**来源**: UCI Machine Learning Repository

**任务**: 预测个人年收入是否超过$50K

**特征** (14个):
- **数值特征** (6个): age, fnlwgt, education-num, capital-gain, capital-loss, hours-per-week
- **分类特征** (8个): workclass, education, marital-status, occupation, relationship, race, sex, native-country

**标签**:
- "<=50K": 年收入不超过50K美元 → 编码为 -1
- ">50K": 年收入超过50K美元 → 编码为 +1

**数据分布**:
- **训练集**: 43,957样本
  - >50K: 10,524 (23.9%)
  - <=50K: 33,433 (76.1%)
- **测试集**: 4,885样本
  - >50K: 1,179 (24.1%)
  - <=50K: 3,706 (75.9%)

---

## 实现细节

### 1. 数据预处理

#### 分类特征编码
- 使用标签编码(Label Encoding)
- 为每个分类特征维护映射字典
- 处理测试集中未见过的类别（映射为-1）
- 处理缺失值"?"（映射为"MISSING"）

#### 数值特征标准化
- 使用Z-score标准化: `x' = (x - μ) / σ`
- 在训练集上计算均值μ和标准差σ
- 使用相同参数标准化测试集

### 2. SVM训练

#### 训练参数
- **学习率**: 0.001
- **训练轮数**: 50 epochs
- **初始化**: 权重和偏置初始化为0
- **优化算法**: 随机梯度下降(SGD)

#### 训练流程
```python
for epoch in range(n_epochs):
    # 随机打乱样本顺序
    indices = random_permutation(n_samples)
    
    for idx in indices:
        # 计算间隔
        margin = y[idx] * (w^T * x[idx] + b)
        
        # 根据梯度公式更新参数
        if margin >= 1:
            w = w - η * λ * w
            b = b
        else:
            w = w - η * (λ * w - y[idx] * x[idx])
            b = b - η * (-y[idx])
```

### 3. 模型评估

在真实测试集上评估模型性能：
```python
predictions = sign(w^T * X_test + b)
accuracy = mean(predictions == y_test) * 100
```

---

## 代码结构

### 主要类和函数

1. **`load_data(filepath)`**
   - 从文本文件加载数据
   - 自动识别是否有标签

2. **`DataPreprocessor`类**
   - `fit_transform()`: 拟合并转换训练数据
   - `transform()`: 转换测试数据
   - `_encode_categorical_features()`: 编码分类特征
   - `_standardize_features()`: 标准化数值特征
   - `_encode_labels()`: 编码标签

3. **`SVMClassifier`类**
   - `fit()`: 使用SGD训练SVM
   - `predict()`: 预测新样本
   - `score()`: 计算准确率

4. **`regularization_analysis()`**
   - 对不同λ值进行实验
   - 返回准确率字典

5. **`plot_regularization_results()`**
   - 生成可视化图表

6. **`save_results_summary()`**
   - 保存结果摘要文件

---

## 作业提交

### 提交文件清单

1. **实验报告** (PDF格式)
   - 基于 `实验报告.md` 转换
   - 包含所有5个要求的内容

2. **源代码**
   - `svm_classifier.py`

3. **可视化图表**
   - `regularization_analysis.png`

### 作业要求对照

✅ **要求1**: SVM关键概念和实现方法概述
   - 见实验报告第1节

✅ **要求2**: 测试准确率截图
   - 见实验报告第2节（程序运行输出）

✅ **要求3**: 正则化分析
   - 测试λ = [1e-3, 1e-2, 1e-1, 1]
   - 列出每个λ值的准确率
   - 详细解释准确率趋势
   - 见实验报告第3节

✅ **要求4**: 代码截图
   - 见实验报告第4节

✅ **要求5**: 完整代码
   - `svm_classifier.py`（约450行）

---

## 技术亮点

1. ✨ **完全手动实现**: 不依赖sklearn等机器学习库
2. ✨ **严格遵循公式**: 按照作业提供的梯度公式实现
3. ✨ **完整的数据预处理**: 处理分类特征、缺失值、标准化
4. ✨ **真实测试集评估**: 使用独立测试集，结果更可靠
5. ✨ **专业的可视化**: 生成高质量的分析图表
6. ✨ **详细的文档**: 代码注释完整，实验报告详细

---

## 常见问题

### Q1: 程序运行需要多长时间？

**A**: 约2-3分钟。主要时间花在训练4个模型（每个50 epochs）。

### Q2: 为什么不使用sklearn？

**A**: 作业要求从零实现SVM，以理解算法的数学原理和实现细节。

### Q3: 可以修改训练参数吗？

**A**: 可以！在代码中修改：
- `learning_rate`: 学习率（默认0.001）
- `n_epochs`: 训练轮数（默认50）
- `lambda_values`: 要测试的λ值列表

### Q4: 如何提高准确率？

**A**: 可以尝试：
- 增加训练轮数（如100 epochs）
- 调整学习率
- 尝试更多的λ值
- 使用学习率衰减策略

### Q5: 为什么准确率是81.56%而不是更高？

**A**: 这是正常的！SVM在Adult Income数据集上的典型准确率在80-85%之间。更高的准确率通常需要：
- 更复杂的特征工程
- 核函数（本作业使用线性核）
- 集成学习方法

---

## 注意事项

1. **运行环境**: 确保安装了numpy和matplotlib
2. **文件路径**: 程序需要在Homework 4new目录下运行
3. **随机性**: 设置了随机种子(42)以确保结果可重复
4. **内存**: 数据集较大，需要足够内存（约500MB）
5. **中文支持**: 图表和输出支持中文显示

---

## 参考资料

- **数据集**: [UCI Adult Dataset](https://archive.ics.uci.edu/ml/datasets/Adult)
- **SVM理论**: 课程讲义 `linear_model.pptx`
- **SGD优化**: 课程讲义第38-39页

---


